{% extends 'main.html' %} 
{% block content %}

<main>

  <form action="" method="POST">
    {%csrf_token%} 
    {{form.as_p}}
    <input type="submit" />
  </form>

  <p> These results are meant to give you a direction but not to replace your strategy </p>
  <p> Get the recent model prediction results for analysis, <a href = {% url 'export-model-results'%}>Click Here</a>.</p>
  <p> Last Date price was extracted: <b>{{date}}</b> </p>
  <p><big>Current 1 hr Candle Stick size: {{ candle_size.one|floatformat:3 }}, direction: <b> {{trade.one}} </b> </big></p>
  <p><big>Current 4 hr Candle Stick size: {{ candle_size.four|floatformat:3 }}, direction: <b> {{trade.four}} </b> </big></p>
  <p>Last open price 1 hr ago: £{{ open_prices.3|floatformat:2 }} </p>
  <p>Last close price 1hr ago: £{{ close_prices.3|floatformat:2 }}</p>
  <p>Last open price 4 hrs ago: £{{ open_prices.0|floatformat:2 }} </p>
  

  <h1>Historical prediction for the last 4 hours</h1>
  <p> Current candle direction <b>{{trade.one}}</b> </p>
  <p> Current hour can fluctuate depending on new data retrieved within the hour! </p>
  <table>
    <tr>
      <th>Profit/Loss</th>
      <th>3 hr ago</th>
      <th>4 hr ago</th>
      <th>1 hr ago</th>
      <th>Current hr</th>
    </tr>


      <tr>
        <td>Open price</td>
        {% for price in open_prices %} 
    
          <td> £{{ price|floatformat:2 }}</td>

        {% endfor %} 
      </tr> 

    {% for category, proba in pred_historical.items %}
      <tr>
        {% if not forloop.last %}
          <td>{{ category }}</td>
          <td>{{ proba.0 }}%</td>
          <td>{{ proba.1 }}%</td>
          <td>{{ proba.2 }}%</td>
          <td>{{ proba.3 }}%</td>
        {% else %}
          <td><b>{{ category }}</b></td>
          <td>{{ proba.0 }}</td>
          <td>{{ proba.1 }}</td>
          <td>{{ proba.2 }}</td>
          <td>{{ proba.3 }}</td>
        {% endif %}
      </tr>
    
      {% if forloop.revcounter0 == 1 %}
        <tr>
          <td colspan="4"><hr></td>
        </tr>
      {% endif %}
      
    {% endfor %}


    </table> 

    <table>

    <h1>Sensitivity test on the prediction if movement reversed</h1>
    <p> Current candle direction <b>{{trade.one}}</b> </p>
    <p> This is to see if prediction holds if movement flips of 15 pips </p>
    <p> and also retaining the trend strenghts </p>
    <table>
      <tr>
        <th>Profit/Loss</th>
        <th>Fliped Movement (15 pips)</th>

      </tr>

    {% for category, proba in pred_variability.items %}
    <tr>
      {% if not forloop.last %}
        <td>{{ category }}</td>
        <td>{{ proba.0 }}%</td>
      {% else %}
        <td><b>{{ category }}</b></td>
        <td>{{ proba.0 }}</td>
      {% endif %}
    </tr>

      {% if forloop.revcounter0 == 1 %}
      <tr>
        <td colspan="4"><hr></td>
      </tr>
    {% endif %}
    
    {% endfor %}
  </table> 


  <hr>
  <h1>Model predictions for next reversed candle</h1>
  <p> Current candle direction <b>{{trade.one}}</b> </p>
  <p> Two scenarios tested (ie., 20 & 40 pips) </p>

  <table>
    <tr>
      <th>Profit/Loss</th>
      <th>Current Proba</th>
      <th>Reversed Proba (20 pips)</th>
      <th>Reversed Proba (40 pips)</th>
    </tr>
    

    {% for category, proba in pred_reverse.items %}
      <tr>
        {% if not forloop.last %}
          <td>{{ category }}</td>
          <td>{{ proba.0 }}%</td>
          <td>{{ proba.1 }}%</td>
          <td>{{ proba.2 }}%</td>
        {% else %}
          <td><b>{{ category }}</b></td>
          <td>{{ proba.0 }}</td>
          <td>{{ proba.1 }}</td>
          <td>{{ proba.2 }}</td>
        {% endif %}
      </tr>

      {% if forloop.revcounter0 == 1 %}
        <tr>
          <td colspan="4"><hr></td>
        </tr>
      {% endif %}
    
    {% endfor %}
  </table> 


  <h1>Model predictions for next candle continuing</h1>
  <p> Current candle direction <b>{{trade.one}}</b> </p>
  <p> Two scenarios tested (ie., 20 & 40 pips)</p>
  <table>
    <tr>
      <th>Profit/Loss</th>
      <th>Current Proba</th>
      <th>Continue Proba (20 pips)</th>
      <th>Continue Proba (40 pips)</th>
    </tr>
    
    {% for category, proba in pred_continue.items %}
     <tr>
       {% if not forloop.last %}
          <td>{{ category }}</td>
          <td>{{ proba.0 }}%</td>
          <td>{{ proba.1 }}%</td>
          <td>{{ proba.2 }}%</td>
        {% else %}
          <td><b>{{ category }}</b></td>
          <td>{{ proba.0 }}</td>
          <td>{{ proba.1 }}</td>
          <td>{{ proba.2 }}</td>
        {% endif %}
      </tr>
      
      {% if forloop.revcounter0 == 1 %}
        <tr>
          <td colspan="4"><hr></td>
        </tr>
      {% endif %}
    
    {% endfor %}

    </table> 
    
   


  <h2>Notes:</h2>
  <p>The model is only about 60 - 70% accurate predicting directions for a four hour timeframe.</p>
  <p>The model is only about 80-90% accurate predicting directions for a one hour timeframe.</p>
  <p>The analysis below show what are the probabilities if the trade directions reverse or continue based on previous trade direction.</p>
  <p>Should there be any major news or events, the model results could be invalidated!.</p>
  <p>If both the reversal and continuation results predict strongly in one direction, then it is a good chance it will go in that direction.</p>

</main>

{% endblock content %}